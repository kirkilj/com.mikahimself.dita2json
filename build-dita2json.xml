<?xml version="1.0" encoding="UTF-8"?>
<project>
    
    <target name="dita2json-dita" depends="build-init, preprocess, generate-json"/>
    
    <target name="generate-json">
        <property name="user.jsonpath.real" location="${output.dir}/json"/>
        <mkdir dir="${user.jsonpath.real}"/>
        
        <xslt style="${dita.plugin.com.mikahimself.dita2json.dir}${file.separator}xsl${file.separator}generate_json.xsl" destdir="${output.dir}/json" basedir="${dita.temp.dir}" filenameparameter="FILENAME" filedirparameter="FILEDIR">
            <mapper type="regexp" from="^(.*)\.dita" to="\1.search"/>
            <param name="OUTPUTDIR" expression="${output.dir}"/>
        </xslt>
        
        <delete file="${output.dir}/json_content.json"/>
        <echo message="[" file="${output.dir}/json_content.json"/>
        <concat destfile="${output.dir}/json_content.json" append="true">
            <fileset dir="${output.dir}/json">
                <include name="**/*.search"/>
            </fileset>
        </concat>
        <echo message='{"title": "NaN", "text": "This item is for tackling the trailing comma, only.", "tags": "", "url": "NaN"}]' file="${output.dir}/json_content.json" append="true"/>
    </target>
    
</project>
